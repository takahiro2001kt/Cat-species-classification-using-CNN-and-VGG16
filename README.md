# Cat-species-classification-using-CNN-and-VGG16
テーマ：**猫の品種分類** <br>
>猫の品種分類を行おうと思った理由として、Cat and Dogsやcifar10のように物体そのものが異なるものの分類は多くなるのに対して、同一動物内での品種分けを行なっているものが少なかった。という理由に加え、個人的興味本位として、同一動物内での分類はどの程度可能なのか。
また、実際に使用する場合に役立ちそうな分類として、猫の品種の違いがわからない人でもどの品種の猫なのかを判別するために実施した。
>> 分類品種<br>
 * アメリカンショートヘア(American_shorthair)
 * マンチカン(Munchikin)
 * ペルシャ(Persian)
 * スコティッシュフォールド(Scottish_fold)



使用モデル・アルゴリズム：**CNN & VGG16**<br>
>画像分類を高精度で行う場合は、CNNが一般的であると思う。そのためCNNをメジャーに使用されている方法として実装。
VGGに関しては動物系の画像が多いImageNetの画像を使用し学習を行なっているため、今回の猫の品種分類では大きな成果を出してくれるのではないかと考え実装することとした。<br>
ImageNetのラベルはこのサイトを参考にした。<br>
https://hazm.at/mox/machine-learning/computer-vision/classification/keras-pre-trained/vgg16/index.html



データの作成方法 <br>
>今回作成するデータは完全にオリジナルなもので実施する。
データ取得はGoogle画像検索を利用し手動で集めた。<br>
私が調査を行なった範囲では、猫を品種ごとに分類しているデータセットを見つけることができなかったため、自分で作成する方法を選んだ。
他の授業(人工知能システム開発等)でデータにノイズが入ると精度が大幅に下がることを知った。<br>そのため、当たり前ではある「マンチカン」のラベル名で「ペルシャ猫」の画像だった。みたいなことは防がなくてはならない。検索結果画像[1]の赤枠の部分のように画像名に品種名が含めれている画像のみを選択し使用することとした。<br>



データセットの概要
>収集したデータ数

| 品種名 | 画像枚数(オリジナル) | 画像枚数(水増し後) |
|:-----------:|:------------:|:------------:|
| アメリカンショートヘア     |    29枚 |     377枚     |
| マンチカン              |    25枚 |    325枚    |
| ペルシャ                |    33枚 |     429枚     |
| スコティッシュフォールド    |    32枚 |      416枚    |

※ 水増しの方法はランダムでの角度変更、倍率の調整を実施<br>角度は45度〜-45度の範囲で実施した。（180度すると猫と判定できない場合を恐れた。）



学習モデルの評価基準
>今回の最終目標は、「猫の品種を分類できること」と定義し、これを目指し実装を行う。<br>
モデルの評価は**val_accuracy**の値を向上させることとした。<br>もちろん過学習は良くないため、**val_loss**の値も参考にし、評価を行なった。<br>
上記2点を評価基準に決定した理由として、各エポックに対する評価指数であるため、各エポックの精度評価を行いやすく一般的な評価方法の一つであると思うためである。
今回は、画像分類を行なったため、最終的には未知の画像データをモデルに食わせ、その結果の正誤結果も評価の方法として実装を行なった。<br>
評価指数参考にしたサイト ： https://qiita.com/AA_Engineer/items/e57738018ab4f35b610f<br>
評価指数参考にしたサイト ： https://stackoverflow.com/questions/50067924/keras-how-to-interpret-the-outputloss-acc-calculated-on-what-data-of-each-ba


実装過程
>実装の手順として
1. データの収集
1. データのリサイズ水増し
1. pickleファイルの作成
1. pickleをGoogleDriveにUpload
1. コード上でDL
1. 人工知能システム開発で使用したコードをベースにコーディング
1. 学習モデルで未知の画像を評価
1. 評価値をもとに、モデルやデータセットの修正等を実施
1. 最良の値が出るまで、上記項目を繰り返す。

精度を良くするために工夫したこと
> 一番精度に影響するのは、モデルの構造と、ハイパーパラメータであると考えた。<br> そのため、上記2項目を変更、チューニングを実施し、精度向上を目指した。<br>
また、CNNよりも条件が合えばVGGの方が精度が高くなることがある。そのた,VGGでの実装も行なった。<br>
>> **CNNの工夫ポイント**<br>
　1. バッチサイズ, Epoch数を変更し、ハイパーパラメータチューニング
  1. Epoch数のみ変更(バッチサイズ固定)

| エポック数 | バッチサイズ | val_accuracy | val_loss |
|:-----------:|:------------:|:------------:|:------------:|
|10   |   32   |   0.877   |   0.383   | 
|20   |   32   |   0.893   |   0.282   |
|30   |   32   |   0.877   |   0.351   |
|40   |   32   |   0.932   |   0.239   |

   2. バッチサイズのみ変更（Epoch数固定）
   ※ Epoch数は一番val_accuracyの精度がよかった40回を採用した。

| エポック数 | バッチサイズ | val_accuracy | val_loss |
|:-----------:|:------------:|:------------:|:------------:|
|40   |   16   |   0.841   |   0.168  | 
|40   |   32   |   0.932   |   0.239   |
|40   |   64   |   0.874   |   0.318   |
|40   |   128   |   0.861   |   0.429   |

   3. 最良値でモデルのみ変更
   ※今までは小規模モデルであったのを、少し大きなモデルに変更して実施

| エポック数 | バッチサイズ | val_accuracy | val_loss |
|:-----------:|:------------:|:------------:|:------------:|
|40   |   16   |   0.883   |   0.717  | 
|40   |   32   |   0.906   |   0.442   |
|40   |   64   |   0.945   |   0.231  |
|40   |   128   |   0.912   |   0.271   |

 CNNでの最良値<br>
 Epoch数 = 40, バッチサイズ = 64, 大きめのモデルが一番良い精度となった。<br>
 未知の画像の分類結果は、ペルシャ猫、スコティッシュフォールドのみ判別ができていた。<br>
 アメリカンショートヘアは、スコティッシュフォールドと間違えてしまっていた。


>>2. VGGでの工夫ポイント
転移学習では、Epoch数が多く学習時間が長い傾向にあるように感じる。<br>
そのため、モデルの実行時にcallbacksを設定し、学習結果の変化が一定値以下の場合に学習を終了し、その時点での最良モデルを保存することで、最短の学習時間で最良の結果ができるように工夫を行なった。転移学習を行なった上での注意としては、VGG16を選択し、動物が多いデータセットで学習されたものを使用することで、精度を向上させたいという意味でVGG16のデータセットを使用することとした。<br>
VGGの結果はこちらを参照：
https://colab.research.google.com/drive/1cDLdeSq2ms6wL1Bn5ZAVYpGjCNbl4hA7?usp=sharing
### 結果
今回の学習結果では、VGGの方が最終的に良い分類ができた。
VGGでは、アメリカンショートヘアとスコティッシュフォールドを間違えてしまった。
人間が見ても、見分けが難しいように感じる。（あくまで私の目での判断だが。）
毛の長いペルシャ猫や、耳のとんがり具合が強い、マンチカンに関してはしっかりと見分けることができた。<br>
ちなみに、ホールドアウト法のテストデータの精度は<br>

10/10 [==============================] - 1s 66ms/step - loss: 0.0168 - accuracy: 0.9935
正解率= 0.9935483932495117 loss= 0.016816504299640656
<br>
となっており、精度99%、loss0.01と非常に素晴らしい値を示している。
confusion_matrixの結果も2要素のみ間違えている。<br>間違えた2要素は
マンチカンをペルシャ猫と間違えている。間違えた要素に関しては、猫の個体差などではないかと考える。
また、アメリカンシュートヘア、スコティッシュフォールドは体格が似ている猫なので、その点から双方の間違えが多くなってしまったのかとも考えた。（特にCNNの部分）
